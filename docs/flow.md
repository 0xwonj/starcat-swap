> **가정**
>
> ETH: BTC = 10: 1
> 유저가 10 ETH과 1 BTC를 스왑하려는 상황
>
> L2 = 스타크넷
> 스타크넷의 컨트랙트(트랜잭션)은 이더리움 또는 비트코인에서 settle 될 수 있음.
>
> L2 컨트랙트는 AMM 유동성 풀이 존재.
>
> 문제가 발생하지 않는 Happy Path 가정.
> 

## Ethereum → Bitcoin

### Phase 1: 이더리움 메인넷의 자산이 올바르게 L2 컨트랙트로 이동되었음을 비트코인의 컨센서스로 확인

1. 이더리움 컨트랙트로 10 ETH와 함께 스왑 요청 트랜잭션 전송
    - 파라미터: 보내는 이더리움 토큰, 받으려는 비트코인 자산 종류, BTC 주소, + options(?)
2. 이더리움 컨트랙트에서 10 ETH를 Lock하고 Event Emit
3. Event를 L2 시퀀서가 캡쳐해서 L2 트랜잭션에 포함
4. L2 컨트랙트에서 해당 트랜잭션이 실행
    - 이더리움 메인넷에서 10 ETH가 전송되었음을 확인하는 트랜잭션
5. 이 L2 컨트랙트가 비트코인에서 ZK Rollup을 통해 Settle 됨.
    - 즉, 비트코인에서 (이더리움에서 L2 컨트랙트로 10 ETH가 이동했음) 을 Settle
    - 비트코인에서 Settle까지 기다려야하기 때문에 시간이 오래 걸릴 것.

### Phase 2:

1. Operator가 L2 컨트랙트에 트랜잭션을 보내서 다음 단계 트리거
    - 트랜잭션에는 Phase 1의 L2 트랜잭션이 비트코인에서 올바르게 Settle 됐음을 증명하는 proof가 포함?
2. 모든 체크가 올바르게 됐으면, L2 교환비를 계산하여 1 BTC를 해당 비트코인 주소로 출금하고 유동성 풀을 업데이트 (ETH +10, BTC -1)
    - 뭔가 잘못됐으면 자동으로 ETH 환불 가능? 또는 직접 트랜잭션 보내서 가져와야 되나?
3. BTC 출금이 완료되면 끝

### 중간에 잘못되거나 거래를 취소하고 ETH를 회수하고 싶은 경우

- 거래가 완료되기 전에는 언제든지 취소하고 맡긴 ETH를 회수 가능하도록
- 일반적인 L1 <> L2 브릿지 작동 방식처럼 Withdrawal Root와 Merkel Proof를 이더리움 컨트랙트에 제출하면 거래가 취소되고 ETH 환불
    - L2 컨트랙트에서 거래가 완료되기 전에는 유동성 풀에 정산이 안되므로 문제 없음.